package zohoincubation.com.zoho.ecommerce.src.view;

import java.util.InputMismatchException;
import java.util.Scanner;
import zohoincubation.com.zoho.ecommerce.src.controller.UserController;
import zohoincubation.com.zoho.ecommerce.src.interfaceController.Editable;
import zohoincubation.com.zoho.ecommerce.src.interfaceController.Execute;
import zohoincubation.com.zoho.ecommerce.src.interfaceController.Viewable;
import zohoincubation.com.zoho.ecommerce.src.model.Client;
import zohoincubation.com.zoho.ecommerce.src.model.Seller;
import zohoincubation.com.zoho.ecommerce.src.model.User;

public class UserHelper implements Execute, Editable, Viewable {
    private final User loggedInUser;
    private final Scanner sc;

    public UserHelper(User loggedInUser, Scanner sc) {
        this.loggedInUser = loggedInUser;
        this.sc = sc;
    }

    @Override
    public String getfunctionName() {
        return "User Management";
    }

    @Override
    public void operation(Scanner sc, User loggedInUser) {
        while (true) {
            System.out.println("====================================");
            System.out.println("         üõ†Ô∏è User Management Menu       ");
            System.out.println("====================================");
            System.out.println("1Ô∏è‚É£ View Info");
            System.out.println("2Ô∏è‚É£ Update Info");
            System.out.println("0Ô∏è‚É£ Exit");
            System.out.println("====================================");
            System.out.print("üëâ Enter your choice: ");
            try {
                int choice = sc.nextInt();
                sc.nextLine();

                switch (choice) {
                    case 1 -> view();
                    case 2 -> update();
                    case 0 -> {
                        System.out.println("üëã Exiting User Management.");
                        return;
                    }
                    default -> System.out.println("‚ùå Invalid choice, please try again.");
                }
            } catch (InputMismatchException e) {
                System.out.println("‚ùå Invalid input. Please enter a valid number.");
                sc.nextLine();
            } catch (Exception e) {
                System.out.println("‚ùå An unexpected error occurred: " + e.getMessage());
            }
        }
    }

    @Override
    public void view() {
        String role = loggedInUser.getRole() == 1 ? "üë§ Client" : "üè¢ Seller";
        System.out.println("""
                ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
               ||                üìã USER INFORMATION                ||  
                ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                """);

        System.out.printf("üîë Role              : %-30s%n", role);
        System.out.printf("üßë Name              : %-30s%n", loggedInUser.getName());
        System.out.printf("üìß Email             : %-30s%n", loggedInUser.getEmail());
        System.out.printf("üÜî User ID           : %-30s%n", loggedInUser.getId());

        if (loggedInUser.getRole() == 2) {
            Seller seller = (Seller) loggedInUser;
            System.out.printf("üí∞ Profit Earned     : ‚Çπ%-29.2f%n", seller.getProfit());
            System.out.printf("üì¶ Products Sold     : %-30d%n", seller.getSoldItem());
        }

        System.out.println("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    }

    @Override
    public void update() {
        ValidData check = new ValidData(sc);
        while (true) {
            System.out.println("""
                    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
                   ||           ‚úèÔ∏è UPDATE USER INFORMATION MENU         ||
                    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
                    1Ô∏è‚É£  üßë  Update Name
                    2Ô∏è‚É£  üì±  Update Phone Number
                    3Ô∏è‚É£  üìß  Update Email
                    4Ô∏è‚É£  üîí  Update Password
                    5Ô∏è‚É£  üöª  Update Gender""");
            if (loggedInUser.getRole() == 1) {
                System.out.println("6Ô∏è‚É£  üè†  Update Address (Client)");
            } else if (loggedInUser.getRole() == 2) {
                System.out.println("""
                        6Ô∏è‚É£  üè¢  Update Company Name (Seller)
                        7Ô∏è‚É£  üìç  Update Company Address (Seller)""");
            }
            System.out.println("""
                    0Ô∏è‚É£  ‚ùå  Exit Update Menu
                    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    """);
            System.out.print("üëâ Enter your choice: ");

            try {
                int choice = sc.nextInt();
                sc.nextLine();

                switch (choice) {
                    case 1 -> {
                        loggedInUser.setName(check.name("üßë Enter new Name: "));
                        System.out.println("‚úÖ Name updated successfully." + loggedInUser.getName());
                    }
                    case 2 -> {
                        loggedInUser.setPhone(isPhoneExists(check.phone("üì± Enter new phone number: "), check));
                        System.out.println("‚úÖ Phone number updated successfully." + loggedInUser.getPhone());
                    }
                    case 3 -> {
                        loggedInUser.setEmail(isEmailExists(check.email("üìß Enter new email: "), check));
                        System.out.println("‚úÖ Email updated successfully." + loggedInUser.getEmail());
                    }
                    case 4 -> {
                        loggedInUser.setPassword(check.password("üîí Enter new password: "));
                        System.out.println("‚úÖ Password updated successfully.");
                    }
                    case 5 -> {
                        loggedInUser.setGender(check.gender("üöª Enter new gender: "));
                        System.out.println("‚úÖ Gender updated successfully." + loggedInUser.getGender());
                    }
                    case 6 -> {
                        if (loggedInUser.getRole() == 1) {
                            ((Client) loggedInUser).setAddress(check.address("üè† Enter new address: "));
                            System.out.println("‚úÖ Address updated successfully." + ((Client) loggedInUser).getAddress());
                        } else if (loggedInUser.getRole() == 2) {
                            ((Seller) loggedInUser).setCompany(check.name("üè¢ Enter new company name: "));
                            System.out.println("‚úÖ Company name updated successfully." + ((Seller) loggedInUser).getCompany());
                        }
                    }
                    case 7 -> {
                        if (loggedInUser.getRole() == 2) {
                            ((Seller) loggedInUser).setCompanyAddress(check.address("üìç Enter new company address: "));
                            System.out.println("‚úÖ Company address updated successfully." + ((Seller) loggedInUser).getCompanyAddress());
                        } else {
                            System.out.println("‚ùå Invalid choice for Client, no updates made.");
                        }
                    }
                    case 0 -> {
                        System.out.println("üëã Exiting Update Menu.");
                        return;
                    }
                    default -> System.out.println("‚ùå Invalid choice, no updates made.");
                }

            } catch (InputMismatchException e) {
                System.out.println("‚ùå Invalid input. Please enter a valid number.");
                sc.nextLine();
            } catch (Exception e) {
                System.out.println("‚ùå An unexpected error occurred: " + e.getMessage());
            }
        }
    }

    public static String[] getDetails(Scanner sc) {
        ValidData check = new ValidData(sc);
        String name = check.name("üßë Enter your Name :");
        String phone = isPhoneExists(check.phone("üì± Enter a valid phone number: "), check);
        String email = isEmailExists(check.email("üìß Enter a valid email address: "), check);
        String password = check.password("üîí Type your Password:");
        String gender = check.gender("üöª Enter your Gender:");

        System.out.println("üë• Are you Signing Up as Client or Seller?\n 1Ô∏è‚É£ Client\n 2Ô∏è‚É£ Seller (Enter @ Number)");
        int userType = sc.nextInt();
        sc.nextLine();

        switch (userType) {
            case 1 -> {
                String address = check.address("üè† Enter Address:");
                return new String[]{name, phone, email, password, gender, address};
            }
            case 2 -> {
                String company = check.name("üè¢ Enter a Company Name :");
                String companyAddress = check.address("üìç Enter a Company Address :");
                return new String[]{name, phone, email, password, gender, company, companyAddress};
            }
            default -> {
                System.out.println("‚ùå Invalid User Type");
                return null;
            }
        }
    }

    private static String isEmailExists(String email, ValidData check) {
        while (UserController.isMailExists(email)) {
            System.out.println("‚ùå Email already exists. Please try again with a different email.");
            email = check.email("üìß Enter a valid email address: ");
        }
        return email;
    }

    private static String isPhoneExists(String phone, ValidData check) {
        while (UserController.isPhoneExists(phone)) {
            System.out.println("‚ùå Phone number already exists. Please try again with a different number.");
            phone = check.phone("üì± Enter a valid phone number: ");
        }
        return phone;
    }
}
